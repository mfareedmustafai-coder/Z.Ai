<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with GLM-4.5 AI | Powered by OpenRouter</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Merriweather', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .user-message {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            margin-left: auto;
            border-radius: 18px 4px 18px 18px;
            max-width: 85%;
            word-wrap: break-word;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .ai-message {
            background: white;
            color: #333;
            margin-right: auto;
            border-radius: 4px 18px 18px 18px;
            max-width: 85%;
            word-wrap: break-word;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #4f46e5;
        }
        .typing-indicator {
            display: inline-block;
            width: 60px;
            height: 24px;
        }
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            margin-right: 4px;
            animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        .message-content {
            line-height: 1.5;
        }
        .message-content pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .message-content code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #dc2626;
        }
        .message-timestamp {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
            display: block;
            text-align: right;
        }
        .model-badge {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 4px;
        }
        .chat-container {
            height: 500px;
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .glow {
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.2);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .creator-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .creator-footer a {
            color: #4f46e5;
            text-decoration: none;
            font-weight: bold;
        }
        .creator-footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body class="p-4">
    <!-- Creator Footer -->
    <div class="creator-footer">
        CREATED BY M.FAREED MUSTAFAI
    </div>

    <div class="max-w-4xl mx-auto mb-16">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">GLM-4.5 AI Chat Assistant</h1>
            <p class="text-white/80">Powered by OpenRouter API | Real-time AI Conversations</p>
        </div>

        <!-- Main Chat Container -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- Status Bar -->
            <div class="bg-gradient-to-r from-[#4f46e5] to-[#7c3aed] text-white p-4 flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-3">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h2 class="font-bold">GLM-4.5 Air (Free)</h2>
                        <p class="text-sm opacity-90">Ready to chat!</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 rounded-full bg-green-400 animate-pulse"></div>
                    <span class="text-sm">Connected</span>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chat-box" class="chat-container overflow-y-auto p-6">
                <!-- Welcome Message -->
                <div class="ai-message p-4 mb-6 fade-in">
                    <div class="flex items-center mb-2">
                        <div class="model-badge pulse">
                            <i class="fas fa-bolt mr-1"></i> GLM-4.5
                        </div>
                        <span class="text-xs text-gray-500 ml-2">via OpenRouter</span>
                    </div>
                    <div class="message-content">
                        <h3 class="font-bold text-lg mb-2">üëã Hello! I'm your AI Assistant</h3>
                        <p class="mb-3">I'm powered by <strong>GLM-4.5 Air</strong> through OpenRouter API. Your API key is configured and ready to use!</p>
                        
                        <div class="bg-blue-50 p-3 rounded-lg mb-3 border border-blue-100">
                            <p class="text-sm font-medium text-blue-800 mb-1"><i class="fas fa-check-circle mr-2"></i>API Status: Connected</p>
                            <p class="text-xs text-blue-600">Model: z-ai/glm-4.5-air:free</p>
                        </div>
                        
                        <p class="text-sm text-gray-600">You can ask me about:</p>
                        <ul class="text-sm text-gray-600 ml-5 mt-1 space-y-1">
                            <li>‚Ä¢ Programming & technology questions</li>
                            <li>‚Ä¢ Creative writing and brainstorming</li>
                            <li>‚Ä¢ Problem solving and analysis</li>
                            <li>‚Ä¢ General knowledge and explanations</li>
                        </ul>
                    </div>
                    <span class="message-timestamp">Ready to assist</span>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-6 border-t border-gray-200">
                <div class="relative">
                    <textarea id="user-input" 
                        class="w-full border-2 border-gray-200 rounded-xl p-4 pr-12 focus:outline-none focus:ring-2 focus:ring-[#4f46e5] focus:border-transparent transition resize-none"
                        placeholder="Type your message here... (Shift+Enter for new line)"
                        rows="2"
                        onkeydown="handleKeyDown(event)"></textarea>
                    
                    <div class="absolute right-4 bottom-4 flex items-center space-x-2">
                        <button onclick="clearChat()" 
                                class="text-gray-400 hover:text-gray-600 transition p-2"
                                title="Clear Chat">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button onclick="sendMessage()" 
                                class="bg-gradient-to-r from-[#4f46e5] to-[#7c3aed] text-white rounded-xl p-3 hover:opacity-90 transition duration-300 glow"
                                id="send-button"
                                title="Send Message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">Quick prompts:</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="quickAction('Who created you?')" 
                                class="text-xs bg-red-100 text-red-700 px-3 py-2 rounded-lg hover:bg-red-200 transition">
                            üë®‚Äçüíª Who made you?
                        </button>
                        <button onclick="quickAction('Explain quantum computing in simple terms')" 
                                class="text-xs bg-blue-100 text-blue-700 px-3 py-2 rounded-lg hover:bg-blue-200 transition">
                            ü§î Explain Quantum Computing
                        </button>
                        <button onclick="quickAction('Write a Python function to calculate factorial')" 
                                class="text-xs bg-green-100 text-green-700 px-3 py-2 rounded-lg hover:bg-green-200 transition">
                            üíª Python Code Example
                        </button>
                        <button onclick="quickAction('Tell me a funny joke about AI')" 
                                class="text-xs bg-purple-100 text-purple-700 px-3 py-2 rounded-lg hover:bg-purple-200 transition">
                            üòÑ Tell a Joke
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-6 text-center text-white/70 text-sm">
            <p>Powered by <a href="https://openrouter.ai" target="_blank" class="underline hover:text-white">OpenRouter</a> | 
            Model: <span class="font-mono">z-ai/glm-4.5-air:free</span> | 
            API Status: <span id="api-status" class="text-green-300">‚úì Connected</span></p>
        </div>
    </div>

    <script>
        // Configuration
        const OPENROUTER_API_KEY = "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";
        const MODEL_ID = "z-ai/glm-4.5-air:free";
        const CREATOR_NAME = "Muhammad Fareed Mustafai";
        
        // DOM Elements
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const apiStatus = document.getElementById('api-status');
        
        // Conversation History
        let conversationHistory = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('GLM-4.5 Chat initialized with API key');
            console.log('CREATED BY ' + CREATOR_NAME);
            testConnection();
            
            // Auto-resize textarea
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        });
        
        // Test API Connection
        async function testConnection() {
            try {
                const response = await fetch('https://openrouter.ai/api/v1/auth/key', {
                    headers: {
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`
                    }
                });
                
                if (response.ok) {
                    apiStatus.innerHTML = '‚úì Connected';
                    apiStatus.className = 'text-green-300';
                    console.log('API connection successful');
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                apiStatus.innerHTML = '‚úó Connection Error';
                apiStatus.className = 'text-red-300';
                console.error('API connection error:', error);
            }
        }
        
        // Handle key events
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // Quick actions
        function quickAction(prompt) {
            userInput.value = prompt;
            userInput.style.height = 'auto';
            userInput.style.height = (userInput.scrollHeight) + 'px';
            userInput.focus();
        }
        
        // Check if message asks about creator
        function isAskingAboutCreator(message) {
            const lowerMessage = message.toLowerCase().trim();
            const creatorKeywords = [
                'who made you',
                'who created you',
                'who built you',
                'who developed you',
                'who designed you',
                'who programmed you',
                'who coded you',
                'who is your creator',
                'who is your developer',
                'who is your programmer',
                'who is your maker',
                'who is your father',
                'who is your parent',
                'made by who',
                'created by who',
                'built by who',
                'fareed',
                'mustafai'
            ];
            
            return creatorKeywords.some(keyword => lowerMessage.includes(keyword));
        }
        
        // Get creator response
        function getCreatorResponse() {
            const responses = [
                `I was created by ${CREATOR_NAME}. He's the talented developer who built this chat interface!`,
                `My creator is ${CREATOR_NAME}. He integrated me with the GLM-4.5 AI model through OpenRouter.`,
                `${CREATOR_NAME} is my creator. He developed this amazing chat application where we can talk!`,
                `This chat interface was built by ${CREATOR_NAME}. He's the one who made it possible for us to communicate!`,
                `I'm powered by GLM-4.5 AI, but this chat application was created by ${CREATOR_NAME}.`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        // Send message function
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Disable input and button
            userInput.disabled = true;
            sendButton.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            // Add user message to chat
            appendMessage(message, 'user');
            
            // Clear input
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Add to conversation history
            conversationHistory.push({
                role: "user",
                content: message
            });
            
            // Check if asking about creator
            if (isAskingAboutCreator(message)) {
                // Remove typing indicator if any
                setTimeout(() => {
                    sendButton.disabled = false;
                    sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
                    userInput.disabled = false;
                    userInput.focus();
                }, 100);
                
                // Show typing indicator
                const typingId = showTypingIndicator();
                
                // Simulate thinking delay
                setTimeout(() => {
                    removeTypingIndicator(typingId);
                    const creatorResponse = getCreatorResponse();
                    appendMessage(creatorResponse, 'ai');
                    
                    // Add to conversation history
                    conversationHistory.push({
                        role: "assistant",
                        content: creatorResponse
                    });
                }, 1500);
                
                return;
            }
            
            // Show typing indicator for regular messages
            const typingId = showTypingIndicator();
            
            try {
                // Get response from OpenRouter
                const response = await getAIResponse();
                
                // Remove typing indicator
                removeTypingIndicator(typingId);
                
                // Add AI response to chat
                appendMessage(response, 'ai');
                
                // Add to conversation history
                conversationHistory.push({
                    role: "assistant",
                    content: response
                });
                
                // Limit history to last 15 messages
                if (conversationHistory.length > 15) {
                    conversationHistory = conversationHistory.slice(-15);
                }
                
            } catch (error) {
                removeTypingIndicator(typingId);
                console.error('Error:', error);
                
                let errorMessage = "Sorry, I encountered an error. ";
                
                if (error.message.includes('401') || error.message.includes('403')) {
                    errorMessage += "API key authentication failed. Please check your OpenRouter API key.";
                } else if (error.message.includes('429')) {
                    errorMessage += "Rate limit exceeded. Please try again in a moment.";
                } else if (error.message.includes('model')) {
                    errorMessage += "The model is currently unavailable. Please try another model.";
                } else if (error.message.includes('network')) {
                    errorMessage += "Network error. Please check your internet connection.";
                } else {
                    errorMessage += "Error: " + error.message;
                }
                
                appendMessage(errorMessage, 'ai', true);
            } finally {
                // Re-enable input and button
                userInput.disabled = false;
                sendButton.disabled = false;
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
                userInput.focus();
            }
        }
        
        // Get AI response from OpenRouter
        async function getAIResponse() {
            const apiUrl = 'https://openrouter.ai/api/v1/chat/completions';
            
            const payload = {
                model: MODEL_ID,
                messages: conversationHistory,
                max_tokens: 1500,
                temperature: 0.7,
                top_p: 0.9,
                frequency_penalty: 0.1,
                presence_penalty: 0.1,
                stream: false
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                    'HTTP-Referer': window.location.origin || 'http://localhost',
                    'X-Title': 'GLM-4.5 Chat Assistant'
                },
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('API Error:', errorText);
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            if (data.choices && data.choices[0] && data.choices[0].message) {
                return data.choices[0].message.content;
            } else {
                throw new Error('Invalid response format from API');
            }
        }
        
        // Append message to chat
        function appendMessage(content, sender, isError = false) {
            const messageElement = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            if (sender === 'user') {
                messageElement.className = 'user-message p-4 mb-4 fade-in';
                messageElement.innerHTML = `
                    <div class="message-content">${escapeHtml(content)}</div>
                    <span class="message-timestamp">${timestamp}</span>
                `;
            } else {
                messageElement.className = 'ai-message p-4 mb-4 fade-in';
                if (isError) {
                    messageElement.innerHTML = `
                        <div class="message-content text-red-600">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            ${escapeHtml(content)}
                        </div>
                        <span class="message-timestamp">${timestamp} ‚Ä¢ Error</span>
                    `;
                } else {
                    messageElement.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="model-badge">
                                <i class="fas fa-robot mr-1"></i> GLM-4.5
                            </div>
                        </div>
                        <div class="message-content">${formatMessage(content)}</div>
                        <span class="message-timestamp">${timestamp}</span>
                    `;
                }
            }
            
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        // Format message with basic markdown
        function formatMessage(text) {
            return escapeHtml(text)
                .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^(<p>)?(.*?)(<\/p>)?$/g, '<p>$2</p>')
                .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-600 hover:underline">$1</a>');
        }
        
        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Show typing indicator
        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.id = 'typing-' + Date.now();
            typingElement.className = 'ai-message p-4 mb-4 fade-in';
            typingElement.innerHTML = `
                <div class="flex items-center mb-2">
                    <div class="model-badge">
                        <i class="fas fa-robot mr-1"></i> GLM-4.5
                    </div>
                </div>
                <div class="typing-indicator mt-2">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <span class="message-timestamp">Thinking...</span>
            `;
            chatBox.appendChild(typingElement);
            chatBox.scrollTop = chatBox.scrollHeight;
            return typingElement.id;
        }
        
        // Remove typing indicator
        function removeTypingIndicator(id) {
            const element = document.getElementById(id);
            if (element) {
                element.remove();
            }
        }
        
        // Clear chat history
        function clearChat() {
            if (conversationHistory.length > 0) {
                if (confirm('Are you sure you want to clear the chat history?')) {
                    chatBox.innerHTML = '';
                    conversationHistory = [];
                    
                    // Add welcome message back
                    const welcomeDiv = document.createElement('div');
                    welcomeDiv.className = 'ai-message p-4 mb-6 fade-in';
                    welcomeDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="model-badge pulse">
                                <i class="fas fa-bolt mr-1"></i> GLM-4.5
                            </div>
                            <span class="text-xs text-gray-500 ml-2">via OpenRouter</span>
                        </div>
                        <div class="message-content">
                            <h3 class="font-bold text-lg mb-2">üí´ Chat Cleared!</h3>
                            <p>I'm ready for a fresh conversation. What would you like to discuss?</p>
                            <p class="mt-2 text-sm text-gray-600">P.S. I was created by ${CREATOR_NAME} üòä</p>
                        </div>
                        <span class="message-timestamp">New conversation started</span>
                    `;
                    chatBox.appendChild(welcomeDiv);
                }
            }
        }
    </script>
</body>
</html>
